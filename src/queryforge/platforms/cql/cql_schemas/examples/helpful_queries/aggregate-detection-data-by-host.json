{
  "id": "aggregate-detection-data-by-host",
  "title": "Aggregate Detection Data by Host",
  "source_file": "Queries-Only/Helpful-CQL-Queries/Aggregate Detection Data by Host.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [],
  "functions_used": [
    "count",
    "format",
    "groupBy",
    "max",
    "min",
    "sort",
    "sum"
  ],
  "operators_used": [
    "=",
    ">",
    "|"
  ],
  "fields_referenced": [
    "ExternalApiType",
    "as",
    "field",
    "format",
    "function",
    "limit",
    "order"
  ],
  "correlation_patterns": [],
  "difficulty": "intermediate",
  "query_type": "detection",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "Detection query for Aggregate Detection Data by Host",
  "query": "ExternalApiType=Event_DetectionSummaryEvent\n| format(format=\"%s > %s\", field=[Tactic, Technique], as=MITRE)\n| groupBy([AgentIdString], function=([count(DetectId, as=totalDetections), sum(Severity, as=severityWeight), min(@timestamp, as=firstDetect), max(@timestamp, as=lastDetect), collect([MITRE])]))\n| formatTime(field=firstDetect, format=\"%Y-%m-%dT%H:%M:%S\", as=firstDetect)\n| formatTime(field=lastDetect, format=\"%Y-%m-%dT%H:%M:%S\", as=lastDetect)\n| sort(severityWeight, order=desc, limit=1000)",
  "key_features": [],
  "related_examples": [],
  "tags": [
    "cross-platform"
  ]
}