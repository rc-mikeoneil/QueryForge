{
  "id": "critical-environment-variable-changed-ssh",
  "title": "Critical Environment Variable Changed SSH",
  "source_file": "Queries-Only/Helpful-CQL-Queries/Critical Environment Variable Changed SSH.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [
    "CriticalEnvironmentVariableChanged"
  ],
  "functions_used": [
    "format",
    "table"
  ],
  "operators_used": [
    "<",
    "=",
    ">",
    "|"
  ],
  "fields_referenced": [
    "EnvironmentVariableName",
    "EnvironmentVariableValue",
    "field"
  ],
  "correlation_patterns": [],
  "difficulty": "basic",
  "query_type": "hunting",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "Hunting query for Critical Environment Variable Changed SSH",
  "query": "#event_simpleName=CriticalEnvironmentVariableChanged\n| EnvironmentVariableName =/(SSH_CONNECTION|USER)/\n| EnvironmentVariableValue=/(?<userName>\\S+)\\n(?<localIP>\\d+\\.\\d+\\.\\d+\\.\\d+)\\s+(?<localPort>\\d+)\\s+(?<remoteIP>\\d+\\.\\d+\\.\\d+\\.\\d+)\\s+(?<remotePort>\\d+)$/i\n| table([@timestamp, aid, userName, remoteIP, remotePort, localIP, localPort])\n| \"Process Explorer\" := format(\"[Process Explorer](https://falcon.crowdstrike.com/investigate/process-explorer/%s/%s)\", field=[\"aid\", \"ContextProcessId\"])",
  "key_features": [],
  "related_examples": [],
  "tags": [
    "criticalenvironmentvariablechanged",
    "cross-platform",
    "ssh"
  ]
}