{
  "id": "cve-2025-42701-and-cve-2025-42706-falcon-version-scoping-osversioninfo",
  "title": "CVE-2025-42701 and CVE-2025-42706 Falcon Version Scoping (OsVersionInfo)",
  "source_file": "Queries-Only/Helpful-CQL-Queries/CVE-2025-42701 and CVE-2025-42706 Falcon Version Scoping (OsVersionInfo).md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [
    "OsVersionInfo"
  ],
  "functions_used": [
    "default",
    "drop",
    "groupBy",
    "join",
    "match",
    "rename"
  ],
  "operators_used": [
    "<",
    "<=",
    "=",
    ">",
    ">=",
    "and",
    "match",
    "or",
    "|"
  ],
  "fields_referenced": [
    "AgentVersion",
    "aid",
    "as",
    "column",
    "field",
    "file",
    "format",
    "function",
    "include",
    "limit",
    "majorVersion",
    "minorVersion",
    "mode",
    "query",
    "replaceEmpty",
    "start",
    "strict",
    "value"
  ],
  "correlation_patterns": [
    "join"
  ],
  "difficulty": "advanced",
  "query_type": "hunting",
  "platforms": [
    "Mac",
    "Win"
  ],
  "use_case": "Hunting query for CVE-2025-42701 and CVE-2025-42706 Falcon Version Scoping (OsVersionInfo)",
  "query": "/*\nThe following query looks for Falcon Sensor for Windows versions that need\nto be hotfixed or updated to address CVE-2025-42701 and CVE-2025-42706.\nThe datasource for this query is the Windows event OsVersionInfo. That event\nis generated on sensor start, atsystem reboot, and/or every 24-hours.\n*/\n\n// Restrict search to OsVersionInfo Windows events\n#event_simpleName=OsVersionInfo event_platform=Win\n\n// Aggregate to get latest build for each Agent ID value\n| groupBy([cid, aid, event_platform], function=([selectLast([AgentVersion])]), limit=max)\n\n// Parse AgentVersion into individual components for evaluation\n| AgentVersion=/^(?<majorVersion>\\d+)\\.(?<minorVersion>\\d+)\\.(?<buildNumber>\\d+)\\./\n\n// Check for updated version\n| case {\n      // Handles 8+\n      majorVersion>7                                    | Status:=\"OK\";\n      // Handles 7.29+\n      majorVersion=7 minorVersion>28                    | Status:=\"OK\";\n      // Handles 7.28\n      majorVersion=7 minorVersion=28 buildNumber<=20006 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=28 buildNumber>=20008 | Status:=\"OK\";\n      // Handles 7.27\n      majorVersion=7 minorVersion=27 buildNumber<=19907 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=27 buildNumber>=19909 | Status:=\"OK\";\n      // Handles 7.26\n      majorVersion=7 minorVersion=26 buildNumber<=19811 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=26 buildNumber>=19813 | Status:=\"OK\";\n      // Hanldes 7.25\n      majorVersion=7 minorVersion=25 buildNumber<=19706 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=25 buildNumber>=19707 | Status:=\"OK\";\n      // Handles 7.24\n      majorVersion=7 minorVersion=24 buildNumber<=19607 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=24 buildNumber>=19600 | Status:=\"OK\";\n      // Handles 7.16 Windows 7\n      majorVersion=7 minorVersion=16 buildNumber<=18635 | Status:=\"HOTFIX AVAILABLE\";\n      majorVersion=7 minorVersion=16 buildNumber>=18637 | Status:=\"OK\";\n      // Handles all other 7 versions\n      majorVersion=7 minorVersion<24  | Status:=\"OUT OF SUPPORT - UPDATE SENSOR\";\n      // Handles all other versions\n      majorVersion<7                  | Status:=\"OUT OF SUPPORT - UPDATE SENSOR\";\n      // Catch all for logic errors\n\t  * | Status:=\"UNKNOWN\";         \n}\n\n// Enrich required fields from aid_master_main.csv\n| aid=~match(file=\"aid_master_main.csv\", column=[aid], include=[ComputerName, ProductType, Version, MAC, SystemManufacturer, SystemProductName, FirstSeen, Time], strict=false)\n\n// Add CID Name\n| join(query={$falcon/investigate:cid_name()}, field=[cid], include=[name], mode=left, start=1d)\n\n// Modify field names for easier reading\n| rename([[name, \"Customer\"], [cid, \"Customer ID\"],[aid, \"Agent ID\"], [event_platform, Platform], [aip, \"External IP\"]])\n\n// Aggregate results into tabular format with cleaner ordering\n| groupBy([Customer, \"Customer ID\", ComputerName, \"Agent ID\", Platform, Version, AgentVersion, Status, \"External IP\", LocalAddressIP4, MAC, SystemManufacturer, SystemProductName, FirstSeen, Time], function=[], limit=max)\n \n// Set default values for easier reading\n| default(value=\"-\", field=[Customer, ComputerName, Version, AgentVersion, Status, LocalAddressIP4, MAC, SystemManufacturer, SystemProductName, FirstSeen, Time], replaceEmpty=true)\n\n// Move timestamps from epoch to human readable\n| formatTime(format=\"%F %T\", as=\"FirstSeen\", field=FirstSeen)\n| formatTime(format=\"%F %T\", as=\"LastSeen\", field=Time)\n\n// Remove unnecessary field\n| drop([Time])",
  "key_features": [
    "Uses join for correlation"
  ],
  "related_examples": [],
  "tags": [
    "join",
    "mac",
    "osversioninfo",
    "win"
  ]
}