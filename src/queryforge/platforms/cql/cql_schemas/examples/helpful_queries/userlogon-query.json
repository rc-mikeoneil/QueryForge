{
  "id": "userlogon-query",
  "title": "UserLogon Query",
  "source_file": "Queries-Only/Helpful-CQL-Queries/UserLogon Query.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [
    "UserLogon"
  ],
  "functions_used": [
    "in",
    "ipLocation",
    "table"
  ],
  "operators_used": [
    "=",
    "in",
    "|"
  ],
  "fields_referenced": [
    "LogonType",
    "UserIsAdmin",
    "UserSid",
    "aip",
    "field",
    "locale",
    "timezone",
    "values"
  ],
  "correlation_patterns": [],
  "difficulty": "intermediate",
  "query_type": "utility",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "Utility query for UserLogon Query",
  "query": "#event_simpleName=UserLogon UserSid=S-1-5-21-*\n| in(LogonType, values=[\"2\",\"10\"])\n| ipLocation(aip)\n| case {UserIsAdmin = \"1\" | UserIsAdmin := \"Yes\" ;\n        UserIsAdmin = \"0\" | UserIsAdmin := \"No\" ;\n        * }\n| case {\n        LogonType = \"2\" | LogonType := \"Interactive\" ;\n        LogonType = \"3\" | LogonType := \"Network\" ;\n        LogonType = \"4\" | LogonType := \"Batch\" ;\n        LogonType = \"5\" | LogonType := \"Service\" ;\n        LogonType = \"7\" | LogonType := \"Unlock\" ;\n        LogonType = \"8\" | LogonType := \"Network Cleartext\" ;\n        LogonType = \"9\" | LogonType := \"New Credentials\" ;\n        LogonType = \"10\" | LogonType := \"Remote Interactive\" ;\n        LogonType = \"11\" | LogonType := \"Cached Interactive\" ;\n        * }\n| PasswordLastSet := PasswordLastSet*1000\n| LogonTime := LogonTime*1000\n| PasswordLastSet := formatTime(\"%Y-%m-%d %H:%M:%S\", field=PasswordLastSet, locale=en_US, timezone=Z)\n| LogonTime := formatTime(\"%Y-%m-%d %H:%M:%S\", field=LogonTime, locale=en_US, timezone=Z)\n| table([\"LogonTime\", \"aid\", \"UserName\", \"UserSid\", \"LogonType\", \"UserIsAdmin\", \"PasswordLastSet\", \"aip.city\", \"aip.state\", \"aip.country\"])",
  "key_features": [
    "IP geolocation enrichment"
  ],
  "related_examples": [],
  "tags": [
    "cross-platform",
    "userlogon"
  ]
}