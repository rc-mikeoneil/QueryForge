{
  "id": "userlogon",
  "title": "UserLogon",
  "source_file": "Queries-Only/Helpful-CQL-Queries/UserLogon.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [
    "UserLogon"
  ],
  "functions_used": [
    "in",
    "ipLocation",
    "table"
  ],
  "operators_used": [
    "=",
    "in",
    "|"
  ],
  "fields_referenced": [
    "UserSid",
    "aip",
    "field",
    "locale",
    "timezone",
    "values"
  ],
  "correlation_patterns": [],
  "difficulty": "intermediate",
  "query_type": "utility",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "Utility query for UserLogon",
  "query": "#event_simpleName=UserLogon UserSid=S-1-5-21-*\n| in(LogonType, values=[\"2\",\"10\"])\n| ipLocation(aip)\n| $falcon/helper:enrich(field=UserIsAdmin)\n| $falcon/helper:enrich(field=UserLogon)\n| PasswordLastSet := PasswordLastSet*1000\n| ContextTimeStamp := ContextTimeStamp*1000\n| PasswordLastSet := formatTime(\"%Y-%m-%d %H:%M:%S\", field=PasswordLastSet, locale=en_US, timezone=Z)\n| ContextTimeStamp := formatTime(\"%Y-%m-%d %H:%M:%S\", field=ContextTimeStamp, locale=en_US, timezone=Z)\n| table([\"ContextTimeStamp\", \"aid\", \"UserName\", \"UserSid\", \"LogonType\", \"UserIsAdmin\", \"PasswordLastSet\", \"aip.city\", \"aip.state\", \"aip.country\"])",
  "key_features": [
    "IP geolocation enrichment"
  ],
  "related_examples": [],
  "tags": [
    "cross-platform",
    "userlogon"
  ]
}