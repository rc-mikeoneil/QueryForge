{
  "id": "clickfixhunting",
  "title": "ClickFixHunting",
  "source_file": "Queries-Only/Helpful-CQL-Queries/ClickFixHunting.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "// Fleshed out query for clickfix detection",
  "mitre_attack": null,
  "event_types": [],
  "functions_used": [],
  "operators_used": [],
  "fields_referenced": [],
  "correlation_patterns": [],
  "difficulty": "basic",
  "query_type": "detection",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "// Fleshed out query for clickfix detection",
  "query": "// Fleshed out query for clickfix detection\n\n#event_simpleName=ProcessRollup2 \n| #repo=base_sensor\n| ParentBaseFileName=explorer.exe\n| TargetProcessId=*\n|in(field=\"FileName\",ignoreCase=true, values=[\n    *powershell*,*pwsh*,*cmd*,*mshta*,*wscript*,*cscript*,\n    *rundll32*,*regsvr32*,*wmic*,*msbuild*,*installutil*,\n    *bitsadmin*,*curl*,*ftp*,*hh*,*schtasks*,*certutil*\n])\n|in(field=\"CommandLine\",ignoreCase=true, values=[\n    *iex*,*irm*,*iwr*,*invoke-webrequest*,*http*,*https*,\n    *ftp*,*smb*,*download*,*encodedcommand*,*bypass*,\n    *invoke-expression*,*reflection.assembly*,*frombase64string*,\n    *start-process*,*comobject*,*new-object*,*datetime*,*encoded*\n])\n| process_tree := format(\"[PT](/graphs/process-explorer/tree?_cid=%s&id=pid:%s:%s&investigate=true&pid=pid:%s:%s)\", field=[\"#repo.cid\",\"aid\",\"TargetProcessId\",\"aid\",\"TargetProcessId\"])\n| groupBy([process_tree,ComputerName,ParentBaseFileName,FileName,CommandLine], limit=max)",
  "key_features": [],
  "related_examples": [],
  "tags": [
    "cross-platform"
  ]
}