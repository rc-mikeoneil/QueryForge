{
  "id": "httprequestdetect",
  "title": "HttpRequestDetect",
  "source_file": "Queries-Only/Helpful-CQL-Queries/HttpRequestDetect.md",
  "category": "helpful_query",
  "subcategory": null,
  "description": "",
  "mitre_attack": null,
  "event_types": [
    "HttpRequestDetect"
  ],
  "functions_used": [
    "format",
    "select"
  ],
  "operators_used": [
    "<",
    "=",
    ">",
    "match",
    "|"
  ],
  "fields_referenced": [
    "H",
    "HttpRequestHeader",
    "ImageFileName",
    "MagicNumber",
    "as",
    "charset",
    "field",
    "format",
    "h"
  ],
  "correlation_patterns": [],
  "difficulty": "basic",
  "query_type": "detection",
  "platforms": [
    "Cross-platform"
  ],
  "use_case": "Detection query for HttpRequestDetect",
  "query": "#event_simpleName=HttpRequestDetect\n| parseHexString(\"HttpPostBody\", as=b64data)\n| format(\"%,.4s\", field=b64data, as=b64data)\n| MagicNumber := base64Decode(b64data, charset=\"UTF-8\")\n| MagicNumber=/^BZ(?<Version>\\w{1})/i\n| Version match {\n\th => Version := \"BZip2\" ;\n\tH => Version := \"BZip2 - Huffman\" ;\n\t0 => Version := \"BZip1\" ;\n}\n| $HttpMethod()\n| ImageFileName=/^\\\\HarddiskVolume\\d(?<FilePath>.*\\\\)(?<FileName>.+)$/i\n| format(format=\"C:%s\", as=FilePath, field=[FilePath])\n| HttpRequestHeader:=urlDecode(HttpRequestHeader)\n| HttpRequestHeader=/User-Agent\\:\\s(?<UserAgentString>.+)\\\\u000d\\\\u000aHost/\n| $AddComputerName()\n| select([ComputerName, FileName, FilePath, HttpUrl, HttpMethod, MagicNumber, Version, UserAgentString, HttpRequestHeader])",
  "key_features": [],
  "related_examples": [],
  "tags": [
    "cross-platform",
    "httprequestdetect"
  ]
}