{
  "best_practices": [
    {
      "category": "time_filtering",
      "title": "Always Include Time Bounds",
      "description": "Queries should include time range filters to limit data volume and improve performance",
      "recommendation": "Add @timestamp >= 'start_time' AND @timestamp <= 'end_time' or use relative time (e.g., last 24h)",
      "severity": "high",
      "example_good": "process_name = 'powershell.exe' AND @timestamp >= now() - 24h",
      "example_bad": "process_name = 'powershell.exe'"
    },
    {
      "category": "result_limiting",
      "title": "Limit Result Sets",
      "description": "Always include a LIMIT clause to prevent excessive result sets",
      "recommendation": "Add | limit N where N is appropriate for your use case (typically 100-10000)",
      "severity": "high",
      "example_good": "process_name = 'cmd.exe' | limit 1000",
      "example_bad": "process_name = 'cmd.exe'"
    },
    {
      "category": "field_selection",
      "title": "Use Indexed Fields for Filtering",
      "description": "Filter on indexed fields when possible for better query performance",
      "recommendation": "Prefer indexed fields in WHERE clauses and avoid filtering on unindexed fields",
      "severity": "medium",
      "example_good": "process_name = 'cmd.exe'",
      "example_bad": "command_line contains 'very_long_unindexed_text'"
    },
    {
      "category": "regex_usage",
      "title": "Avoid Overly Broad Regex Patterns",
      "description": "Broad regex patterns like .* can be slow and resource-intensive",
      "recommendation": "Use specific patterns and anchor your regex when possible (^, $)",
      "severity": "medium",
      "example_good": "command_line =~ /^powershell.*-enc/",
      "example_bad": "command_line =~ /.*/"
    },
    {
      "category": "wildcard_usage",
      "title": "Avoid Leading Wildcards",
      "description": "Leading wildcards prevent index usage and can be very slow",
      "recommendation": "Avoid patterns like '*value' - use 'value*' or exact matches instead",
      "severity": "high",
      "example_good": "file_path = 'C:\\Windows\\Temp\\*'",
      "example_bad": "file_path = '*\\malware.exe'"
    },
    {
      "category": "quoting",
      "title": "Quote String Values Properly",
      "description": "String values should be quoted, and special characters must be escaped",
      "recommendation": "Use single quotes for strings and escape backslashes, quotes, and special chars",
      "severity": "high",
      "example_good": "file_path = 'C:\\\\Windows\\\\System32'",
      "example_bad": "file_path = C:\\Windows\\System32"
    },
    {
      "category": "boolean_logic",
      "title": "Use Parentheses for Complex Logic",
      "description": "Complex boolean expressions should use parentheses for clarity and correct precedence",
      "recommendation": "Group conditions with parentheses, especially when mixing AND/OR",
      "severity": "medium",
      "example_good": "(process_name = 'cmd.exe' OR process_name = 'powershell.exe') AND severity > 5",
      "example_bad": "process_name = 'cmd.exe' OR process_name = 'powershell.exe' AND severity > 5"
    },
    {
      "category": "projection",
      "title": "Select Only Needed Fields",
      "description": "Projecting only required fields reduces data transfer and improves performance",
      "recommendation": "Use | select field1, field2 to limit returned fields",
      "severity": "low",
      "example_good": "process_name = 'cmd.exe' | select process_name, command_line, @timestamp | limit 100",
      "example_bad": "process_name = 'cmd.exe' | limit 100"
    },
    {
      "category": "case_sensitivity",
      "title": "Understand Case Sensitivity",
      "description": "FQL field names and operators may be case-sensitive or insensitive depending on configuration",
      "recommendation": "Use consistent casing for field names; use case-insensitive operators when needed",
      "severity": "low",
      "example_good": "process_name contains 'powershell'",
      "example_bad": "PROCESS_NAME = 'PowerShell'"
    },
    {
      "category": "aggregation",
      "title": "Use Aggregations for Summary Data",
      "description": "When counting or summarizing, use aggregation functions instead of retrieving all records",
      "recommendation": "Use aggregation pipeline operators for counts, sums, and grouping",
      "severity": "medium",
      "example_good": "process_name = 'cmd.exe' | stats count by user_name",
      "example_bad": "process_name = 'cmd.exe' | limit 10000"
    }
  ],
  "query_optimization": {
    "tips": [
      "Start with most selective filters (those that match fewest records)",
      "Use indexed fields in filter conditions when possible",
      "Combine multiple conditions with AND to narrow results early",
      "Apply time range filters as early as possible in the query",
      "Use specific field searches instead of free-text searches",
      "Test queries on small time windows before expanding scope"
    ]
  },
  "security_considerations": {
    "tips": [
      "Avoid exposing sensitive data in query results",
      "Use appropriate field projection to limit sensitive field exposure",
      "Consider data retention and compliance requirements",
      "Validate and sanitize user input in dynamic queries",
      "Use parameterized queries when possible to prevent injection"
    ]
  }
}
